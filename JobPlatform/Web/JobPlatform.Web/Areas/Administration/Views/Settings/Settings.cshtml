@model JobPlatform.Web.ViewModels.Administration.Dashboard.UsersViewModel
@{
    this.ViewData["Title"] = "User Admin Panell";
}

<h1>@this.ViewData["Title"]</h1>

<form id="userForm" method="post"></form>
<div class="container">
    <input class="form-control mb-4" id="tableSearch" type="text" placeholder="Search User by User Name">

            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>User Name</th>
                        <th>Full Name</th>
                        @foreach (var role in Model.Roles)
                        {
                            <th>@role.Name</th>
                        }
                    </tr>
                </thead>
                <tbody id="userTable">
                    @foreach (var user in this.Model.Users)
                    {
                        <tr id="@user.Id">
                            <td><a href="@user.Id" target="_blank">@user.UserName</a></td>
                            <td>@user.FullName</td>
                            @foreach (var roleId in Model.Roles)
                            {
                                @if (user.RolesName.FirstOrDefault(x => x
                                 == roleId.Name) != null)
                                {
                                    <td>
                                        <a href="#" style="color: green" onclick="changeRole('@user.Id', '@roleId.Id', false),reresh()">
                                            <div>
                                                <i class="fa fa-check"></i>
                                            </div>
                                        </a>
                                    </td>
                                }
                                else
                                {
                                    <td>
                                        <a href="#" style="color: red" onclick="changeRole('@user.Id', '@roleId.Id', true),reresh()">
                                            <div>
                                                <i class="fa fa-times"></i>
                                            </div>
                                        </a>
                                    </td>
                                }
                            }

                        </tr>
                    }
                </tbody>
            </table>
</div>
@*<nav>
    <ul class="pagination justify-content-center">
        @if (this.Model.CurrentPage == 1)
        {
            <li class="page-item disabled">
                <a class="page-link" href="#">Previous</a>
            </li>
        }
        else
        {
            <li class="page-item">
                <a class="page-link"
                   asp-route="forumCategory"
                   asp-route-name="@this.Model.Title"
                   asp-route-page="@(this.Model.CurrentPage - 1)">Previous</a>
            </li>
        }

        @for (int i = 1; i <= this.Model.PagesCount; i++)
        {
            var active = i == this.Model.CurrentPage ? "active" : string.Empty;
            <li class="page-item @active">
                <a class="page-link"
                   asp-route="forumCategory"
                   asp-route-name="@this.Model.Title"
                   asp-route-page="@i">@i</a>
            </li>
        }

        @if (this.Model.CurrentPage == this.Model.PagesCount)
        {
            <li class="page-item disabled">
                <a class="page-link" href="#">Next</a>
            </li>
        }
        else
        {
            <li class="page-item">
                <a class="page-link"
                   asp-route="forumCategory"
                   asp-route-name="@this.Model.Title"
                   asp-route-page="@(this.Model.CurrentPage + 1)">Next</a>
            </li>
        }
    </ul>
</nav>*@

 @section Scripts {
                <script>

                    function changeRole(userId, roleId, onOff) {
                        var token = $("#userForm input[name=__RequestVerificationToken]").val();
                        var json = { userId: userId, roleId: roleId, onOff: onOff };

                        $.ajax({
                            url: "/api/role",
                            type: "POST",
                            data: JSON.stringify(json),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            headers: { 'X-CSRF-TOKEN': token },
                            success: $.ready.then.call(reresh())

                        });

                        function reresh() {
                            setTimeout(function () {// wait for 5 secs(2)
                                location.reload(); // then reload the page.(3)
                            }, 1000);
                        }
                    }

                    $(document).ready(function () {
                        $("#tableSearch").on("keyup", function () {
                            var value = $(this).val().toLowerCase();
                            $("#userTable tr").filter(function () {
                                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                            });
                        });
                    });

                </script>
            }
